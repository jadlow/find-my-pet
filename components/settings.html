[[extend 'layout.html']]

<style>
   [v-cloak] {
      display: none;
   }
</style>

<div class="section" id="vue-target-settings" v-cloak>
   <h1 class="title">User Settings</h1>
   <div v-if="!post_success">
      <div class="field">
         <label class="label">Photo upload (required, one photo only)</Label>
         <div class="field has-addons">
             <p class="control">
               <div class="file is-info" v-if="upload_id_temp == -1">
                 <label class="file-label">
                   <input class="file-input" type="file" @change="upload_file($event)">
                   <span class="file-cta">
                     <span class="file-icon">
                       <i v-if="uploading" class="fa fa-spinner fa-pulse fa-fw"></i>
                       <i v-else class="fa fa-upload fa-fw"></i>
                     </span>
                     <span class="file-label">
                       <span v-if="!uploading">Upload photo</span>
                     </span>
                   </span>
                 </label>
               </div>
             </p>
             <p class="control">
               <button v-if="upload_id_temp != -1" class="button" @click="download_file"
                       :class="{'disabled': !file_path}">
                 <span class="icon" v-if="download_url">
                   <i class="fa fa-download fa-fw"></i>
                 </span>
                 <span>{{file_info}}</span>
               </button>
               <button v-else class="button is-static">No photo uploaded</button>
             </p>
             <p class="control" v-if='temp_file_path'>
               <button class="button is-danger" @click="pseudo_delete_file" :class="{'is-loading': deleting}">
                 <span v-if="delete_confirmation">Confirm deletion</span>
                 <i v-else class="fa fa-trash"></i>
               </button>
             </p>
           </div>
         <div>
             
         </div>
         <div class="has-text-danger" v-if="err_photo_bad_type">
             Error file extension not supported. Please upload a photo file of the extension
             <span v-for="ext in photo_extensions">
                 {{ext}}<span v-if="ext != photo_extensions[photo_extensions.length - 1]">,</span><span v-else>.</span>
                 <span v-if="ext == photo_extensions[photo_extensions.length - 2]">or</span>
             </span>
         </div>
         <div class="has-text-danger" v-if="err_photo_null">
             Error no photo uploaded. Please upload a photo.
         </div>
     </div>
      <!-- <div class="field">
         <label class="label">First Name</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="first_name">
         </div>
         <div class="has-text-danger" v-if="err_first_name">
            Error {{err_first_name_i}}
         </div>
      </div>
      <div class="field">
         <label class="label">Last Name</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="last_name">
         </div>
         <div class="has-text-danger" v-if="err_last_name">
            Error {{err_last_name_i}}
         </div>            
      </div>
      <div class="field">
         <label class="label">Email</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="email">
         </div>
         <div class="has-text-danger" v-if="err_email">
            Error {{err_email_i}}
         </div>            
      </div> -->
      <div class="field">
         <label class="label">Phone Number</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="phone_num">
         </div>
         <div class="has-text-danger" v-if="err_phone_num">
            Error {{err_phone_num_i}}
         </div>
      </div>
      <div class="field">
         <label class="label">Radius</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="radius">
         </div>
         <div class="has-text-danger" v-if="err_phone_num">
            Error {{err_phone_num_i}}
         </div>
      </div>
      <div class="field">
         <label class="label">Location</label>
         <div class="control">
            <input type="text" class="input is-info" v-model="coordinates" @change="location_preview()" @input="location_preview()" @keyup="location_preview()" @paste="location_preview()">
            <div style="margin-top: 3px;">
               <button class="button is-info" @click="show_get_coord_info = true"><i class="fa fa-info-circle"></i>&ensp;How to get coordinates</button>&ensp;
               <button class="button is-info" @click="current_location(); prg_geoloc = true"><i class="fa fa-map-pin"></i>&ensp;Get current location (permissions needed)</button>
            </div>
         </div>
         <div class="has-text-danger" v-if="err_coordinates">
            Error {{err_coordinates_i}}
         </div>
         <div class="has-text-grey" v-if="war_geoloc">
            This site is not able to get your current location due to lack of permissions.
         </div>
         <div class="has-text-grey" v-if="prg_geoloc">
            Retrieving current location...
         </div>
         <div class="is-size-5" style="margin-top: 5px;">
            Preview of set location
            <iframe src="https://maps.google.com/maps?output=embed" id="display_location" style="border: 3px solid #d00000; border-radius: 4px; height: 200px; width: 100%;"></iframe>
            Zoom: <i class="fa fa-search-minus"></i>&ensp;<input type="range" class="range" min="1" max="18" v-model="location_preview_zoom" @change="location_preview()">&ensp;<i class="fa fa-search-plus"></i>
         </div>
      </div>
      <button class="button is-link" @click="settings()">Save Changes</button>
   </div>

   <div v-if="post_success" class="notification is-success is-size-5">
      Success! Your new settings have been saved.
   </div>
   <div class="modal is-active" v-if="show_get_coord_info">
      <div class="modal-background"></div>
      <div class="modal-content is-size-5">
         <div class="box has-text-right" style="background: transparent; padding: 0; margin-bottom: 3px;">
            <button class="button is-danger" @click="show_get_coord_info = false" style="border-radius: 60%; height: 40px; width: 40px;"><i class="fa fa-times"></i></button>
         </div>
         <div class="box">
            To get the coordinates, please go to <a href="https://www.google.com/maps" target="_blank">Google Maps</a>.
            Navigate to the location where the pet was lost or found.
            Right-click directly on the location and select the coordinates which will be automatically copied.
         </div>
      </div>
   </div>
   <div class="modal is-active" v-if="err_main">
      <div class="modal-background"></div>
      <div class="modal-content is-size-5">
         <div class="box has-text-right" style="background: transparent; padding: 0; margin-bottom: 3px;">
            <button class="button is-danger" @click="err_main = false" style="border-radius: 60%; height: 40px; width: 40px;"><i class="fa fa-times"></i></button>
         </div>
         <div class="box">
            There has been an error with your submission information.
            Please check the form's fields.
         </div>
      </div>
   </div>
</div>
[[block page_scripts]]
<script>
   let user_settings_url = "[[=XML(user_settings_url)]]";
   let get_user_info_url = "[[=XML(get_user_info_url)]]";
   let get_file_info_url = "[[=XML(get_file_info_url)]]";
   let file_info_url = "[[=XML(file_info_url)]]";
   let obtain_gcs_url = "[[=XML(obtain_gcs_url)]]";
   let notify_url = "[[=XML(notify_url)]]";
   let delete_url = "[[=XML(delete_url)]]";
</script>
<script src="js/settings.js"></script>
[[end]]
